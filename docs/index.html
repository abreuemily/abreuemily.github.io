<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emily</title>
    <!-- BootStrap5  CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <!-- BootStrap5 JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <!-- BootStrap5  Option 1: Include  icons in HTML -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>

<body>
    <div class="container mt-3">
        <h1>Contatos - Supabase (DOCS)</h1>
        <form id="form-buscar">
            <h4>Busca</h4>
            <label for="input-buscar">Nome:</label>
            <input type="text" id="input-buscar">
            <input type="button" id="btn-buscar" value="Buscar">

        </form>
        <button id="btn-novo">Novo</button>

        <div id="form-contato" style="display: none;" class="card mt-3">
            <h4 id="form-titulo" class="card-header">Novo Contato</h4>
            <form>
                <div class="mb-3">
                    <label for="input-nome" class="form-label">Nome: </label>
                    <input type="text" name="nome" id="input-nome" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="input-telefone" class="form-label">Fone: </label>
                    <input type="text" name="telefone" id="input-telefone" class="form-label">

                    <label for="input-email" class="form-label">E-mail: </label>
                    <input type="email" name="email" id="input-email" class="form-label">
                </div>
                <input type="button" id="btn-salvar" value="Salvar">
                <input type="button" id="btn-cancelar" value="Cancelar">
            </form>
        </div>
        <table id="tabela-contatos" class="table"></table>
    </div>

    <script>

        const SUPABASE_URL = "https://chptkbsncebafurislzn.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNocHRrYnNuY2ViYWZ1cmlzbHpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY1MTc4MzUsImV4cCI6MjA0MjA5MzgzNX0.J92mx4sfidBKqAKsg4YBqTbzQoqsq-4XH7Kh91jNWaI";
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        $(document).ready(function () {
            console.log("jQuery está funcionando!");

            // Função para mostrar o formulário
            $('#btn-novo').click(function () {
                $('#form-contato').show();
                console.log("Botão Novo foi clicado");
            });

            // Função para ocultar o formulário
            $('#btn-cancelar').click(function () {
                $('#form-contato').hide();
                console.log("Botão Cancelar foi clicado");
            });

            // Função para salvar o contato
            $('#btn-salvar').click(async function () {
                console.log("Botão Salvar foi clicado");

                let nome = $('#input-nome').val();
                let telefone = $('#input-telefone').val();
                let email = $('#input-email').val();

                if (nome && telefone && email) {
                    const { data, error } = await supabase
                        .from('CONTATO')
                        .insert([{ nome: nome, telefone: telefone, email: email }]);

                    if (error) {
                        alert("Erro ao salvar o contato: " + error.message);
                    } else {
                        alert("Contato salvo com sucesso!");
                        $('#form-contato').hide();
                        listarContatos();  // Atualiza a lista de contatos
                    }
                } else {
                    alert("Por favor, preencha todos os campos.");
                }
            });

            // Função para buscar contato pelo nome
            $('#btn-buscar').click(async function () {
                console.log("Botão Buscar foi clicado");

                let nomeBusca = $('#input-buscar').val();

                if (nomeBusca) {
                    const { data, error } = await supabase
                        .from('CONTATO')
                        .select()
                        .ilike('nome', `%${nomeBusca}%`);  // Busca insensível a maiúsculas e minúsculas

                    if (error) {
                        alert("Erro ao buscar contato: " + error.message);
                    } else if (data.length > 0) {
                        mostrarContatos(data);
                    } else {
                        alert("Nenhum contato encontrado.");
                    }
                } else {
                    alert("Por favor, insira um nome para buscar.");
                }
            });

            // Função para listar todos os contatos
            async function listarContatos() {
                const { data, error } = await supabase
                    .from('CONTATO')
                    .select();

                if (error) {
                    alert("Erro ao listar contatos: " + error.message);
                } else {
                    mostrarContatos(data);
                }
            }

            // Função para exibir os contatos na tabela
            function mostrarContatos(contatos) {
                let tabela = $('#tabela-contatos');
                tabela.empty();  // Limpa a tabela antes de adicionar novos dados
                let header = `<tr><th>Nome</th><th>Telefone</th><th>Email</th></tr>`;
                tabela.append(header);

                contatos.forEach(contato => {
                    let row = `<tr><td>${contato.nome}</td><td>${contato.telefone}</td><td>${contato.email}</td></tr>`;
                    tabela.append(row);
                });
            }

            // Carregar os contatos ao iniciar a página
            listarContatos();
        });
    </script>
</body>

</html>